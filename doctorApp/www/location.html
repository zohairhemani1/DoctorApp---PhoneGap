<html>
    <head>
        <title>Doctor Visit 247</title>
        <link href="css/default.css" type="text/css" rel="stylesheet" />
        <link href="css/style.css" type="text/css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=0, minimal-ui" />
        <meta name="viewport" content="width=620, user-scalable=no" />
        <meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,width=device-width,user-scalable=no" />
        <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=0" />
        <meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,width=device-width,height=device-height,target-densitydpi=device-dpi,user-scalable=yes" />

    </head>
    <body>



        <div class="wrapper">
            <div class="title"><img src="img/first_aid.png" class="title-logo"/><h1 id="title-location" class="uppercase">Request a visit<br /><span style='font-size:10px;'>Step two</span></h1></div>
            <form id="location" name="locationForm">
                <h3 id="location_form_head"></h3>
                    <label id="unit" for="unit"></label><input id="unit" name="unit" type="text" /><br/>
                <label id="street" for="street"></label><input id="street" name="street" type="text" /><br/>
                <label id="city" for="city"></label><input id="city" name="city" type="text" /><br/>
                <label id="zipcode" for="zipcode"></label><input id="zipcode" name="zipcode" type="text" /><br/>
                <label id="directions" for="directions"></label><textarea rows="4" cols="22" id="directions"></textarea><br/>
                <input type="hidden" name="burns">
            </form>




            <div style="text-align:center" class="footer bottom"><a class="btns next" id="next_step" onclick="next()"  target="_blank"><!--href="tel:" --></a></div>
        </div>

    </body>
    <script src="js/string.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>


    <script>
        if(localStorage.language == "French"){
            var APP_CONSTANTS = FRENCH_CONSTANTS;
        }else if(localStorage.language == "Spanish"){
            var APP_CONSTANTS = SPANISH_CONSTANTS;
        }else{
            var APP_CONSTANTS = ENGLISH_CONSTANTS;
        }
        
        document.getElementById('title-location').innerHTML = APP_CONSTANTS.REQUEST_VISIT + "<br /><span style='font-size:10px;'>"+APP_CONSTANTS.STEP_ONE+"</span>";
        document.getElementById('location_form_head').innerHTML = APP_CONSTANTS.LOCATION.toUpperCase();
        document.getElementById('unit').innerHTML = APP_CONSTANTS.UNIT.toUpperCase();
        document.getElementById('street').innerHTML = APP_CONSTANTS.STREET.toUpperCase();
        document.getElementById('city').innerHTML = APP_CONSTANTS.CITY.toUpperCase();
        document.getElementById('zipcode').innerHTML = APP_CONSTANTS.ZIPCODE.toUpperCase();
        document.getElementById('directions').innerHTML = APP_CONSTANTS.DIRECTIONS.toUpperCase();
        document.getElementById('next_step').innerHTML = APP_CONSTANTS.NEXT_STEP.toUpperCase();
        
        document.locationForm.burns.value = window.location;
        var text = document.locationForm.burns.value;
        console.log(text);
    </script>







    <script>

        function ready(latitude, longitude)
        {
            var r = httpGet("https://maps.googleapis.com/maps/api/geocode/json?latlng="+latitude+","+longitude+"&sensor=false");
            return getAddress(r);
        }

        function httpGet(theUrl)
        {
            var xmlHttp = null;

            xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false );
            xmlHttp.send( null );
            return xmlHttp.responseText;
        }

        function getAddress(response)
        {
            var obj = jQuery.parseJSON(response);
            //return obj.results[0].formatted_address;
            console.log(obj);
            if (obj.results[0].formatted_address)
                return obj.results[0].formatted_address;
            else{obj.status}




        }


        var lat; var long;
        function next(){
            navigator.geolocation.getCurrentPosition(GetLocation);
            //alert(long);
            document.getElementById('address').value = ready(lat,long);

                navigator.geolocation.getCurrentPosition(GetLocation);
                //  alert(long);
                document.getElementById('address').value = ready(lat,long);
                alert('sending');

            ajaxcall();


            console.log(document.getElementById('address').value);
            document.forms["request"].submit();


        }
        function ajaxcall(){
            $.ajax({

                type: "GET",
                url: "http://www.fajjemobile.info/doctorapp/email.php",
                data: 'first_name=' + localStorage.getItem(first_name)+'&'+'last_name=' + localStorage.getItem(last_name)
                +'&'+'phone=' + localStorage.getItem(phone)+'&'+'address=' + localStorage.getItem(address)+'&'+'unit='
                + $('#unit').val()+'&'+'street=' + $('#street').val()+'&'+'city=' +
                $('#city').val()+'&'+'zipcode=' + $('#zipcode').val()+'&'+'directions=' +
                $('#directions').val(),
                // $('#address').val()
                success: function(msg){
                    //  $('#resultip').html(msg);
                    alert('done');
                },
                error:function(msg){
                    console.log(msg);
                    alert('not');
                }

            }); // Ajax Call
        }
        function GetLocation(location) {
            lat = location.coords.latitude;
            long = location.coords.longitude;
        }

    </script>





</html>